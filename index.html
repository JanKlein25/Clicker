<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>KleinClicker: Reborn</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=Space+Grotesk:wght@300;500;700&display=swap"
    rel="stylesheet">
  <!-- FIREBASE SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <style>
    :root {
      /* --- PALETTE --- */
      --bg-dark: #09090b;
      --bg-panel: #121216;
      --bg-panel-trans: rgba(18, 18, 22, 0.85);

      --primary: #f59e0b;
      /* Amber */
      --primary-glow: rgba(245, 158, 11, 0.4);

      --accent: #6366f1;
      /* Indigo */
      --accent-glow: rgba(99, 102, 241, 0.4);

      --success: #10b981;
      --danger: #ef4444;
      --text-main: #f8fafc;
      --text-muted: #94a3b8;

      /* --- RARITY --- */
      --r-common: #94a3b8;
      --r-rare: #3b82f6;
      --r-epic: #a855f7;
      --r-legendary: #eab308;
      --r-mythic: #ef4444;

      /* --- ANIMATIONS --- */
      --ease-elastic: cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      user-select: none;
      -webkit-user-select: none;
      outline: none;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Outfit', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-main);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: row;
    }

    /* --- TYPOGRAPHY --- */
    h1,
    h2,
    h3 {
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 700;
    }

    .text-gradient {
      background: linear-gradient(135deg, var(--primary), #d97706);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* --- LAYOUT --- */
    #game-layer {
      display: flex;
      width: 100%;
      height: 100%;
      position: relative;
      z-index: 10;
    }

    .panel-left {
      flex: 1;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at center, #1e1e24 0%, var(--bg-dark) 100%);
      z-index: 1;
    }

    .panel-right {
      width: 400px;
      background: var(--bg-panel);
      border-left: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      z-index: 20;
      box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
      transition: transform 0.3s var(--ease-elastic);
    }

    /* --- COMPONENTS --- */
    .btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text-main);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 700;
      transition: all 0.15s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn-primary {
      background: var(--primary);
      color: #000;
      border: none;
      box-shadow: 0 4px 15px var(--primary-glow);
    }

    .btn-primary:hover {
      background: #fbbf24;
    }

    .btn-accent {
      background: var(--accent);
      border: none;
      box-shadow: 0 4px 15px var(--accent-glow);
    }

    .btn-accent:hover {
      background: #818cf8;
    }

    .btn-danger {
      background: var(--danger);
      border: none;
      color: white;
    }

    /* --- CLICK AREA --- */
    .score-display {
      text-align: center;
      margin-bottom: 40px;
      z-index: 10;
      pointer-events: none;
    }

    .score-val {
      font-size: 4rem;
      font-weight: 900;
      line-height: 1;
      text-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
    }

    .score-label {
      font-size: 1.2rem;
      color: var(--primary);
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-top: 5px;
    }

    .cps-label {
      font-size: 1rem;
      color: var(--text-muted);
      background: rgba(0, 0, 0, 0.3);
      padding: 4px 12px;
      border-radius: 20px;
      margin-top: 10px;
      display: inline-block;
    }

    #big-klein {
      width: 320px;
      height: 320px;
      object-fit: contain;
      cursor: pointer;
      transition: transform 0.05s cubic-bezier(0.1, 0.9, 0.2, 1);
      filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.6));
      z-index: 10;
      position: relative;
    }

    #big-klein:active {
      transform: scale(0.92);
    }

    #big-klein:hover {
      filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.1));
    }

    /* --- PARTICLE SYSTEM --- */
    .particle-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 50;
    }

    .click-particle {
      position: absolute;
      font-weight: 900;
      font-size: 1.5rem;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
      will-change: transform, opacity;
    }

    .bg-icon {
      position: absolute;
      opacity: 0.05;
      font-size: 2rem;
      pointer-events: none;
      z-index: 0;
    }

    /* --- RIGHT PANEL (Tabs & Content) --- */
    .panel-tabs {
      display: flex;
      background: #000;
      padding: 5px;
      gap: 5px;
    }

    .tab-btn {
      flex: 1;
      background: transparent;
      border: none;
      color: #666;
      padding: 12px;
      font-weight: 700;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .tab-btn.active {
      background: #222;
      color: var(--text-main);
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 0;
      position: relative;
    }

    .scroll-content {
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* --- BUILDINGS --- */
    .building-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 12px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }

    .building-card:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .building-card.locked {
      opacity: 0.5;
      filter: grayscale(1);
      pointer-events: none;
    }

    .building-card.can-afford {
      border-left: 3px solid var(--success);
    }

    .b-icon {
      font-size: 2rem;
      width: 50px;
      text-align: center;
      margin-right: 10px;
    }

    .b-info {
      flex: 1;
    }

    .b-name {
      font-weight: 700;
      font-size: 1rem;
    }

    .b-cost {
      font-size: 0.85rem;
      color: var(--danger);
      font-weight: 600;
    }

    .b-cost.affordable {
      color: var(--success);
    }

    .b-count {
      font-size: 1.5rem;
      font-weight: 900;
      color: rgba(255, 255, 255, 0.1);
      margin-left: 10px;
    }

    /* --- UPGRADES --- */
    .upgrade-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
      gap: 8px;
      padding: 10px;
    }

    .upgrade-item {
      width: 50px;
      height: 50px;
      background: #222;
      border: 1px solid #333;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .upgrade-item:hover {
      border-color: var(--primary);
      transform: scale(1.1);
      z-index: 5;
    }

    /* --- MOBILE --- */
    @media (max-width: 800px) {
      body {
        flex-direction: column;
      }

      .panel-left {
        flex: 1;
        min-height: 50vh;
      }

      .panel-right {
        width: 100%;
        height: 50vh;
        box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
      }
    }

    /* --- MODALS --- */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      z-index: 100;
      display: none;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .modal-overlay.open {
      display: flex;
      opacity: 1;
    }

    .modal-window {
      background: #18181b;
      border: 1px solid #333;
      border-radius: 16px;
      width: 90%;
      max-width: 600px;
      padding: 25px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
      transform: scale(0.9);
      transition: transform 0.3s var(--ease-elastic);
    }

    .modal-overlay.open .modal-window {
      transform: scale(1);
    }

    /* --- UTILS --- */
    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>

  <div id="game-layer">
    <!-- LEFT PANEL: ACTION -->
    <div class="panel-left">
      <div class="particle-container" id="particle-layer"></div>

      <div class="score-display">
        <div class="score-val" id="score">0</div>
        <div class="score-label">Kleinis</div>
        <div class="cps-label" id="cps">0.0 / sec</div>
      </div>

      <img src="https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png" id="big-klein"
        alt="Click Me">

      <div style="margin-top: 30px; display: flex; gap: 10px;">
        <button class="btn" onclick="UI.openModal('casino')">üé∞ Casino</button>
        <button class="btn" onclick="UI.openModal('prestige')">üöÄ Prestige</button>
      </div>
    </div>

    <!-- RIGHT PANEL: SHOP & STATS -->
    <div class="panel-right">
      <div class="panel-tabs">
        <button class="tab-btn active" onclick="UI.switchTab('buildings')">Buildings</button>
        <button class="tab-btn" onclick="UI.switchTab('upgrades')">Upgrades</button>
        <button class="tab-btn" onclick="UI.switchTab('settings')">Settings</button>
      </div>

      <div class="panel-content" id="tab-buildings">
        <div class="scroll-content" id="building-list">
          <!-- Buildings injected here -->
        </div>
      </div>

      <div class="panel-content hidden" id="tab-upgrades">
        <div class="upgrade-grid" id="upgrade-list">
          <!-- Upgrades injected here -->
        </div>
      </div>

      <div class="panel-content hidden" id="tab-settings">
        <div class="scroll-content">
          <h3>Settings</h3>
          <button class="btn btn-danger" onclick="Game.hardReset()">Hard Reset</button>
          <div style="margin-top:20px; font-size:0.8rem; color:#666;">
            KleinClicker Reborn v2.0<br>
            Original by Jan, Malte, et al.<br>
            Refactored by Antigravity
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODALS PLACEHOLDER -->
  <div class="modal-overlay" id="modal-casino">
    <div class="modal-window">
      <h2>üé∞ Casino Royale</h2>
      <p>Coming Soon in Step 2...</p>
      <button class="btn" onclick="UI.closeModals()">Close</button>
    </div>
  </div>

  .building-card.can-afford {
  border-left: 3px solid var(--success);
  }

  .b-icon {
  font-size: 2rem;
  width: 50px;
  text-align: center;
  margin-right: 10px;
  }

  .b-info {
  flex: 1;
  }

  .b-name {
  font-weight: 700;
  font-size: 1rem;
  }

  .b-cost {
  font-size: 0.85rem;
  color: var(--danger);
  font-weight: 600;
  }

  .b-cost.affordable {
  color: var(--success);
  }

  .b-count {
  font-size: 1.5rem;
  font-weight: 900;
  color: rgba(255, 255, 255, 0.1);
  margin-left: 10px;
  }

  /* --- UPGRADES --- */
  .upgrade-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
  gap: 8px;
  padding: 10px;
  }

  .upgrade-item {
  width: 50px;
  height: 50px;
  background: #222;
  border: 1px solid #333;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  }

  .upgrade-item:hover {
  border-color: var(--primary);
  transform: scale(1.1);
  z-index: 5;
  }

  /* --- MOBILE --- */
  @media (max-width: 800px) {
  body {
  flex-direction: column;
  }

  .panel-left {
  flex: 1;
  min-height: 50vh;
  }

  .panel-right {
  width: 100%;
  height: 50vh;
  box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
  }
  }

  /* --- MODALS --- */
  .modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(10px);
  z-index: 100;
  display: none;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s;
  }

  .modal-overlay.open {
  display: flex;
  opacity: 1;
  }

  .modal-window {
  background: #18181b;
  border: 1px solid #333;
  border-radius: 16px;
  width: 90%;
  max-width: 600px;
  padding: 25px;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
  transform: scale(0.9);
  transition: transform 0.3s var(--ease-elastic);
  }

  .modal-overlay.open .modal-window {
  transform: scale(1);
  }

  /* --- UTILS --- */
  .hidden {
  display: none !important;
  }
  </style>
  </head>

  <body>

    <div id="game-layer">
      <!-- LEFT PANEL: ACTION -->
      <div class="panel-left">
        <div class="particle-container" id="particle-layer"></div>

        <div class="score-display">
          <div class="score-val" id="score">0</div>
          <div class="score-label">Kleinis</div>
          <div class="cps-label" id="cps">0.0 / sec</div>
        </div>

        <img src="https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png" id="big-klein"
          alt="Click Me">

        <div style="margin-top: 30px; display: flex; gap: 10px;">
          <button class="btn" onclick="UI.openModal('casino')">üé∞ Casino</button>
          <button class="btn" onclick="UI.openModal('prestige')">üöÄ Prestige</button>
        </div>
      </div>

      <!-- RIGHT PANEL: SHOP & STATS -->
      <div class="panel-right">
        <div class="panel-tabs">
          <button class="tab-btn active" onclick="UI.switchTab('buildings')">Buildings</button>
          <button class="tab-btn" onclick="UI.switchTab('upgrades')">Upgrades</button>
          <button class="tab-btn" onclick="UI.switchTab('settings')">Settings</button>
        </div>

        <div class="panel-content" id="tab-buildings">
          <div class="scroll-content" id="building-list">
            <!-- Buildings injected here -->
          </div>
        </div>

        <div class="panel-content hidden" id="tab-upgrades">
          <div class="upgrade-grid" id="upgrade-list">
            <!-- Upgrades injected here -->
          </div>
        </div>

        <div class="panel-content hidden" id="tab-settings">
          <div class="scroll-content">
            <h3>Settings</h3>
            <button class="btn btn-danger" onclick="Game.hardReset()">Hard Reset</button>
            <div style="margin-top:20px; font-size:0.8rem; color:#666;">
              KleinClicker Reborn v2.0<br>
              Original by Jan, Malte, et al.<br>
              Refactored by Antigravity
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MODALS PLACEHOLDER -->
    <!-- CASINO MODAL -->
    <div class="modal-overlay" id="modal-casino">
      <div class="modal-window">
        <h2>üé∞ Casino Royale</h2>
        <div style="background:#000; padding:20px; border-radius:8px; margin:20px 0; text-align:center;">
          <div id="roulette-wheel" style="font-size:3rem; height:60px; overflow:hidden;">üçí üçã üçá üíé 7Ô∏è‚É£</div>
        </div>
        <div style="display:flex; gap:10px; justify-content:center; margin-bottom:20px;">
          <input type="number" id="bet-amount" placeholder="Bet Amount"
            style="background:#222; border:1px solid #444; color:white; padding:10px; border-radius:4px; width:100px;">
          <button class="btn btn-primary" onclick="Game.spinCasino()">SPIN (x3-x50)</button>
        </div>
        <div style="font-size:0.8rem; color:#666; text-align:center;">
          üçíx3 ‚Ä¢ üçãx5 ‚Ä¢ üçáx10 ‚Ä¢ üíéx25 ‚Ä¢ 7Ô∏è‚É£x50
        </div>
        <button class="btn" style="margin-top:20px; width:100%;" onclick="UI.closeModals()">Close</button>
      </div>
    </div>

    <div class="modal-overlay" id="modal-prestige">
      <div class="modal-window">
        <h2>üöÄ Ascension</h2>
        <p>Ascend to a higher plane of existence.</p>
        <div style="margin: 20px 0; text-align: center;">
          <div style="font-size: 2rem; font-weight: 900; color: var(--primary);">+<span id="prestige-gain">0</span>
            Levels</div>
          <div style="color: #666;">Requires 1M Total Score</div>
        </div>
        <button class="btn btn-primary" id="prestige-btn-action" onclick="Game.doPrestige()" disabled>Ascend</button>
        <button class="btn" onclick="UI.closeModals()">Close</button>
      </div>
    </div>

    <script>
      /* =========================================
         CORE ARCHITECTURE
         ========================================= */

      // --- CONSTANTS & DATA ---
      const CONFIG = {
        fps: 30,
        autoSaveInterval: 10000,
        version: 'KleinClicker_Reborn_v1'
      };

      const BUILDINGS = [
        { id: 0, name: 'Maxis Zeigefinger', baseCost: 15, baseCps: 0.1, icon: 'üëÜ' },
        { id: 1, name: 'Magdas Oma', baseCost: 100, baseCps: 1, icon: 'üëµ' },
        { id: 2, name: 'Cedrics Acker', baseCost: 1100, baseCps: 8, icon: 'üåæ' },
        { id: 3, name: 'Maltes Meme Mine', baseCost: 12000, baseCps: 47, icon: '‚õèÔ∏è' },
        { id: 4, name: 'Jans Strandkorbfabrik', baseCost: 130000, baseCps: 260, icon: 'üè≠' },
        { id: 5, name: 'Tills Tresor', baseCost: 1400000, baseCps: 1400, icon: 'üè¶' },
        { id: 6, name: 'Nicos Sekten-Tempel', baseCost: 20000000, baseCps: 7800, icon: 'üèõÔ∏è' },
        { id: 7, name: 'Maxis Klon-Labor', baseCost: 330000000, baseCps: 45000, icon: 'üß¨' },
        { id: 8, name: 'Magdas Mars-Rakete', baseCost: 5100000000, baseCps: 280000, icon: 'üöÄ' },
        { id: 9, name: 'Cedrics Dimensionstor', baseCost: 75000000000, baseCps: 1600000, icon: 'üåÄ' },
        { id: 10, name: 'Maltes Zeitmaschine', baseCost: 900000000000, baseCps: 12000000, icon: '‚è≥' },
        { id: 11, name: 'Franjas feuchtes Universum', baseCost: 15000000000000, baseCps: 150000000, icon: 'üåå' }
      ];

      // --- UTILS ---
      const Utils = {
        format: (num) => {
          if (num < 1000) return Math.floor(num);
          const suffixes = ["", "k", "M", "B", "T", "Qa", "Qi", "Sx", "Sp", "Oc", "No", "Dc"];
          const suffixNum = Math.floor(("" + Math.floor(num)).length / 3);
          let shortValue = parseFloat((suffixNum != 0 ? (num / Math.pow(1000, suffixNum)) : num).toPrecision(3));
          if (shortValue % 1 != 0) { shortValue = shortValue.toFixed(1); }
          return shortValue + suffixes[suffixNum];
        },
        uuid: () => 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
          const r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
          return v.toString(16);
        })
      };

      // --- AUDIO MANAGER ---
      class AudioManager {
        constructor() {
          this.ctx = new (window.AudioContext || window.webkitAudioContext)();
          this.enabled = true;
        }

        playTone(freq, type, duration) {
          if (!this.enabled) return;
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.type = type;
          osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
          gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
          osc.connect(gain);
          gain.connect(this.ctx.destination);
          osc.start();
          osc.stop(this.ctx.currentTime + duration);
        }

        playClick() { this.playTone(600 + Math.random() * 200, 'sine', 0.1); }
        playBuy() { this.playTone(400, 'square', 0.1); setTimeout(() => this.playTone(600, 'square', 0.1), 100); }
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(10px);
  z-index: 100;
  display: none;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s;
  }

  .modal-overlay.open {
  display: flex;
  opacity: 1;
  }

  .modal-window {
  background: #18181b;
  border: 1px solid #333;
  border-radius: 16px;
  width: 90%;
  max-width: 600px;
  padding: 25px;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
  transform: scale(0.9);
  transition: transform 0.3s var(--ease-elastic);
  }

  .modal-overlay.open .modal-window {
  transform: scale(1);
  }

  /* --- UTILS --- */
  .hidden {
  display: none !important;
  }
  </style>
  </head>

  <body>

    <div id="game-layer">
      <!-- LEFT PANEL: ACTION -->
      <div class="panel-left">
        <div class="particle-container" id="particle-layer"></div>

        <div class="score-display">
          <div class="score-val" id="score">0</div>
          <div class="score-label">Kleinis</div>
          <div class="cps-label" id="cps">0.0 / sec</div>
        </div>

        <img src="https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png" id="big-klein"
          alt="Click Me">

        <div style="margin-top: 30px; display: flex; gap: 10px;">
          <button class="btn" onclick="UI.openModal('casino')">üé∞ Casino</button>
          <button class="btn" onclick="UI.openModal('prestige')">üöÄ Prestige</button>
        </div>
      </div>

      <!-- RIGHT PANEL: SHOP & STATS -->
      <div class="panel-right">
        <div class="panel-tabs">
          <button class="tab-btn active" onclick="UI.switchTab('buildings')">Buildings</button>
          <button class="tab-btn" onclick="UI.switchTab('upgrades')">Upgrades</button>
          <button class="tab-btn" onclick="UI.switchTab('skins')">Skins</button>
          <button class="tab-btn" onclick="UI.switchTab('settings')">Settings</button>
        </div>

        <div class="panel-content" id="tab-buildings">
          <div class="scroll-content" id="building-list">
            <!-- Buildings injected here -->
          </div>
        </div>

        <div class="panel-content hidden" id="tab-upgrades">
          <div class="upgrade-grid" id="upgrade-list">
            <!-- Upgrades injected here -->
          </div>
        </div>

        <div class="panel-content hidden" id="tab-skins">
          <div class="scroll-content">
            <h3>Skins</h3>
            <div id="skin-list" class="upgrade-grid">
              <!-- Skins injected here -->
            </div>
            <button class="btn btn-primary" style="margin-top:20px;" onclick="Game.buySkinCase()">Buy Skin Case (100k)</button>
          </div>
        </div>

        <div class="panel-content hidden" id="tab-settings">
          <div class="scroll-content">
            <h3>Settings</h3>
            <button class="btn btn-danger" onclick="Game.hardReset()">Hard Reset</button>
            <div style="margin-top:20px; font-size:0.8rem; color:#666;">
              KleinClicker Reborn v2.0<br>
              Original by Jan, Malte, et al.<br>
              Refactored by Antigravity
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MODALS PLACEHOLDER -->
    <!-- CASINO MODAL -->
    <div class="modal-overlay" id="modal-casino">
      <div class="modal-window">
        <h2>üé∞ Casino Royale</h2>
        <div style="background:#000; padding:20px; border-radius:8px; margin:20px 0; text-align:center;">
          <div id="roulette-wheel" style="font-size:3rem; height:60px; overflow:hidden;">üçí üçã üçá üíé 7Ô∏è‚É£</div>
        </div>
        <div style="display:flex; gap:10px; justify-content:center; margin-bottom:20px;">
          <input type="number" id="bet-amount" placeholder="Bet Amount"
            style="background:#222; border:1px solid #444; color:white; padding:10px; border-radius:4px; width:100px;">
          <button class="btn btn-primary" onclick="Game.spinCasino()">SPIN (x3-x50)</button>
        </div>
        <div style="font-size:0.8rem; color:#666; text-align:center;">
          üçíx3 ‚Ä¢ üçãx5 ‚Ä¢ üçáx10 ‚Ä¢ üíéx25 ‚Ä¢ 7Ô∏è‚É£x50
        </div>
        <button class="btn" style="margin-top:20px; width:100%;" onclick="UI.closeModals()">Close</button>
      </div>
    </div>

    <div class="modal-overlay" id="modal-prestige">
      <div class="modal-window">
        <h2>üöÄ Ascension</h2>
        <p>Ascend to a higher plane of existence.</p>
        <div style="margin: 20px 0; text-align: center;">
          <div style="font-size: 2rem; font-weight: 900; color: var(--primary);">+<span id="prestige-gain">0</span>
            Levels</div>
          <div style="color: #666;">Requires 1M Total Score</div>
        </div>
        <button class="btn btn-primary" id="prestige-btn-action" onclick="Game.doPrestige()" disabled>Ascend</button>
        <button class="btn" onclick="UI.closeModals()">Close</button>
      </div>
    </div>

    <script>
      /* =========================================
         CORE ARCHITECTURE
         ========================================= */

      // --- CONSTANTS & DATA ---
      const CONFIG = {
        fps: 30,
        autoSaveInterval: 10000,
        version: 'KleinClicker_Reborn_v1'
      };

      const BUILDINGS = [
        { id: 0, name: 'Maxis Zeigefinger', baseCost: 15, baseCps: 0.1, icon: 'üëÜ' },
        { id: 1, name: 'Magdas Oma', baseCost: 100, baseCps: 1, icon: 'üëµ' },
        { id: 2, name: 'Cedrics Acker', baseCost: 1100, baseCps: 8, icon: 'üåæ' },
        { id: 3, name: 'Maltes Meme Mine', baseCost: 12000, baseCps: 47, icon: '‚õèÔ∏è' },
        { id: 4, name: 'Jans Strandkorbfabrik', baseCost: 130000, baseCps: 260, icon: 'üè≠' },
        { id: 5, name: 'Tills Tresor', baseCost: 1400000, baseCps: 1400, icon: 'üè¶' },
        { id: 6, name: 'Nicos Sekten-Tempel', baseCost: 20000000, baseCps: 7800, icon: 'üèõÔ∏è' },
        { id: 7, name: 'Maxis Klon-Labor', baseCost: 330000000, baseCps: 45000, icon: 'üß¨' },
        { id: 8, name: 'Magdas Mars-Rakete', baseCost: 5100000000, baseCps: 280000, icon: 'üöÄ' },
        { id: 9, name: 'Cedrics Dimensionstor', baseCost: 75000000000, baseCps: 1600000, icon: 'üåÄ' },
        { id: 10, name: 'Maltes Zeitmaschine', baseCost: 900000000000, baseCps: 12000000, icon: '‚è≥' },
        { id: 11, name: 'Franjas feuchtes Universum', baseCost: 15000000000000, baseCps: 150000000, icon: 'üåå' }
      ];

      // --- UTILS ---
      const Utils = {
        format: (num) => {
          if (num < 1000) return Math.floor(num);
          const suffixes = ["", "k", "M", "B", "T", "Qa", "Qi", "Sx", "Sp", "Oc", "No", "Dc"];
          const suffixNum = Math.floor(("" + Math.floor(num)).length / 3);
          let shortValue = parseFloat((suffixNum != 0 ? (num / Math.pow(1000, suffixNum)) : num).toPrecision(3));
          if (shortValue % 1 != 0) { shortValue = shortValue.toFixed(1); }
          return shortValue + suffixes[suffixNum];
        },
        uuid: () => 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
          const r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
          return v.toString(16);
        })
      };

      // --- AUDIO MANAGER ---
      class AudioManager {
        constructor() {
          this.ctx = new (window.AudioContext || window.webkitAudioContext)();
          this.enabled = true;
        }

        playTone(freq, type, duration) {
          if (!this.enabled) return;
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.type = type;
          osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
          gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
          osc.connect(gain);
          gain.connect(this.ctx.destination);
          osc.start();
          osc.stop(this.ctx.currentTime + duration);
        }

        playClick() { this.playTone(600 + Math.random() * 200, 'sine', 0.1); }
        playBuy() { this.playTone(400, 'square', 0.1); setTimeout(() => this.playTone(600, 'square', 0.1), 100); }
        playWin() {
          [440, 554, 659].forEach((f, i) => setTimeout(() => this.playTone(f, 'triangle', 0.3), i * 100));
        }
      }

      // --- DATA: SKINS ---
    const SKINS = [
        { id: 'default', name: 'Original Klein', rarity: 'common', url: 'https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png', filter: '' },
        { id: 'sepia', name: 'Retro Klein', rarity: 'common', url: 'https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png', filter: 'sepia(1)' },
        { id: 'invert', name: 'Evil Klein', rarity: 'rare', url: 'https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png', filter: 'invert(1)' },
        { id: 'blur', name: 'Ghost Klein', rarity: 'epic', url: 'https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png', filter: 'blur(5px)' },
        { id: 'hue', name: 'Party Klein', rarity: 'legendary', url: 'https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png', filter: 'hue-rotate(90deg)' }
    ];

      // --- DATA: UPGRADES ---
      const UPGRADES = [
        { id: 'u_click_1', name: 'Plastic Mouse', cost: 500, trigger: { type: 'clicks', val: 100 }, icon: 'üñ±Ô∏è', desc: 'Click power x2', type: 'click', multi: 2 },
        { id: 'u_click_2', name: 'Gamer Mouse', cost: 50000, trigger: { type: 'clicks', val: 1000 }, icon: 'üéÆ', desc: 'Click power x2', type: 'click', multi: 2 },
        // Building Upgrades
        { id: 'u_b0_1', name: 'Carpaltunnel', cost: 1000, trigger: { type: 'build', id: 0, val: 10 }, icon: 'ü©π', desc: 'Finger production x2', type: 'build', target: 0, multi: 2 },
        { id: 'u_b1_1', name: 'Rolling Pin', cost: 5000, trigger: { type: 'build', id: 1, val: 10 }, icon: 'ü•ñ', desc: 'Grandma production x2', type: 'build', target: 1, multi: 2 },
        { id: 'u_b2_1', name: 'Fertilizer', cost: 150000, trigger: { type: 'build', id: 2, val: 10 }, icon: 'üí©', desc: 'Farm production x2', type: 'build', target: 2, multi: 2 },
        { id: 'u_b3_1', name: 'Dynamite', cost: 1200000, trigger: { type: 'build', id: 3, val: 10 }, icon: 'üß®', desc: 'Mine production x2', type: 'build', target: 3, multi: 2 },
        // Prestige Upgrades (Heavenly Chips)
        { id: 'p_perm_1', name: 'Divine Patience', cost: 10, currency: 'chips', icon: '‚ú®', desc: 'Permanent +10% CPS', type: 'prestige', multi: 1.1 },
        { id: 'p_start_1', name: 'Head Start', cost: 50, currency: 'chips', icon: 'üèÅ', desc: 'Start with 10 Fingers', type: 'prestige_start', amount: 10, target: 0 }
      ];

      // --- GAME ENGINE ---
      class GameEngine {
        constructor() {
          this.state = {
            score: 0,
            totalScore: 0,
            clicks: 0,
            buildings: new Array(BUILDINGS.length).fill(0),
            upgrades: [], // IDs of owned upgrades
            prestige: { level: 0, chips: 0, upgrades: [] },
            skins: { owned: ['default'], equipped: 'default' },
            startTime: Date.now()
          };
          this.lastTick = performance.now();
        }

        init() {
          this.load();
          this.loop();
          setInterval(() => this.save(), CONFIG.autoSaveInterval);
          console.log("Game Engine Initialized");
        }

        loop(currentTime = performance.now()) {
          const dt = (currentTime - this.lastTick) / 1000;
          this.lastTick = currentTime;

          if (dt > 0) {
            this.update(dt);
            UI.render();
          }

          requestAnimationFrame((t) => this.loop(t));
        }

        update(dt) {
          if (dt > 1) dt = 1;
          const cps = this.getCPS();
          if (cps > 0) this.addScore(cps * dt);

          // Check Unlocks
          UI.checkUnlocks();
        }

        addScore(amount) {
          this.state.score += amount;
          this.state.totalScore += amount;
        }

        click() {
          const power = this.getClickPower();
          this.addScore(power);
          this.state.clicks++;
          Audio.playClick();
          return power;
        }

        // --- CALCULATIONS ---
        getMultiplier(type, targetId = null) {
          let multi = 1;
          // Normal Upgrades
          this.state.upgrades.forEach(uid => {
            const u = UPGRADES.find(x => x.id === uid);
            if (u && u.type === type) {
              if (type === 'build' && u.target === targetId) multi *= u.multi;
              if (type === 'click') multi *= u.multi;
            }
          });
          // Prestige Multiplier (Base + Upgrades)
          let prestigeMulti = 1 + (this.state.prestige.level * 0.10); // +10% per level
          this.state.prestige.upgrades.forEach(uid => {
            const u = UPGRADES.find(x => x.id === uid);
            if (u && u.type === 'prestige') prestigeMulti *= u.multi;
          });

          return multi * prestigeMulti;
        }

        getCPS() {
          let cps = 0;
          this.state.buildings.forEach((count, i) => {
            cps += count * BUILDINGS[i].baseCps * this.getMultiplier('build', i);
          });
          return cps;
        }

        getClickPower() {
          let base = 1 + (this.getCPS() * 0.01);
          return base * this.getMultiplier('click');
        }

        getBuildingCost(id) {
          return Math.floor(BUILDINGS[id].baseCost * Math.pow(1.15, this.state.buildings[id]));
        }

        // --- ACTIONS ---
        buyBuilding(id) {
          const cost = this.getBuildingCost(id);
          if (this.state.score >= cost) {
            this.state.score -= cost;
            this.state.buildings[id]++;
            Audio.playBuy();
            return true;
          }
          return false;
        }

        buyUpgrade(id) {
          const u = UPGRADES.find(x => x.id === id);
          if (!u) return;

          if (u.currency === 'chips') {
            if (this.state.prestige.chips >= u.cost && !this.state.prestige.upgrades.includes(id)) {
              this.state.prestige.chips -= u.cost;
              this.state.prestige.upgrades.push(id);
              Audio.playBuy();
              return true;
            }
          } else {
            if (this.state.score >= u.cost && !this.state.upgrades.includes(id)) {
              this.state.score -= u.cost;
              this.state.upgrades.push(id);
              Audio.playBuy();
              return true;
            }
          }
          return false;
        }

        spinCasino() {
          const input = document.getElementById('bet-amount');
          const bet = parseInt(input.value);
          if (!bet || bet <= 0) return alert("Invalid bet!");
          if (bet > this.state.score) return alert("Not enough Kleinis!");

          this.state.score -= bet;

          // Logic
          const r = Math.random();
          let winMulti = 0;
          let symbol = 'üçí';

          if (r < 0.02) { winMulti = 50; symbol = '7Ô∏è‚É£'; }
          else if (r < 0.05) { winMulti = 25; symbol = 'üíé'; }
          else if (r < 0.15) { winMulti = 10; symbol = 'üçá'; }
          else if (r < 0.30) { winMulti = 5; symbol = 'üçã'; }
          else if (r < 0.50) { winMulti = 3; symbol = 'üçí'; }
          else { symbol = 'üí©'; }

          // Visuals
          const wheel = document.getElementById('roulette-wheel');
          wheel.innerHTML = "üé∞ üé∞ üé∞";

          setTimeout(() => {
            wheel.innerHTML = `${symbol} ${symbol} ${symbol}`;
            if (winMulti > 0) {
              const winAmount = bet * winMulti;
              this.addScore(winAmount);
              Audio.playWin();
              alert(`YOU WON ${Utils.format(winAmount)}!`);
            } else {
              alert("You lost!");
            }
            this.save();
          }, 1000);
        }

        // --- SKINS ---
        equipSkin(id) {
            if(this.state.skins.owned.includes(id)) {
                this.state.skins.equipped = id;
                UI.updateSkin();
            }
        }

        buySkinCase() {
            const cost = 100000; // Fixed cost for now
            if(this.state.score >= cost) {
                this.state.score -= cost;
                const r = Math.random();
                let skin = SKINS[0];
                if(r < 0.05) skin = SKINS[4]; // Legendary
                else if(r < 0.15) skin = SKINS[3]; // Epic
                else if(r < 0.30) skin = SKINS[2]; // Rare
                else skin = SKINS[1]; // Common (not default)
                
                if(!this.state.skins.owned.includes(skin.id)) {
                    this.state.skins.owned.push(skin.id);
                    alert(`You got: ${skin.name}!`);
                } else {
                    alert(`Duplicate: ${skin.name}. Refunded 50%.`);
                    this.state.score += cost * 0.5;
                }
                UI.renderSkins();
            } else {
                alert("Need 100k Kleinis!");
            }
        }

        // --- PRESTIGE ---
        getPrestigeGain() {
          if (this.state.totalScore < 1000000) return 0;
          const potential = Math.floor(Math.cbrt(this.state.totalScore / 1000000));
          return Math.max(0, potential - this.state.prestige.level);
        }

        doPrestige() {
          const gain = this.getPrestigeGain();
          if (gain <= 0) return;

          this.state.prestige.level += gain;
          this.state.prestige.chips += gain; // 1 Chip per Level gained

          // Reset
          this.state.score = 0;
          this.state.clicks = 0;
          this.state.buildings = new Array(BUILDINGS.length).fill(0);
          this.state.upgrades = [];

          // Apply Start Bonuses
          this.state.prestige.upgrades.forEach(uid => {
            const u = UPGRADES.find(x => x.id === uid);
            if (u && u.type === 'prestige_start') {
              this.state.buildings[u.target] += u.amount;
            }
          });

          this.save();
          location.reload();
        }

        // --- SAVE/LOAD ---
        save() {
          const data = JSON.stringify(this.state);
          const checksum = btoa(data + "SALT_123");
          localStorage.setItem(CONFIG.version, JSON.stringify({ data, checksum }));
        }

        load() {
          try {
            const raw = localStorage.getItem(CONFIG.version);
            if (raw) {
              const { data, checksum } = JSON.parse(raw);
              if (btoa(data + "SALT_123") === checksum) {
                const parsed = JSON.parse(data);
                this.state = { ...this.state, ...parsed };
                // Migration for skins if missing
                if(!this.state.skins) this.state.skins = { owned: ['default'], equipped: 'default' };
              }
            }
          } catch (e) { console.error("Load failed", e); }
        }

        hardReset() {
          if (confirm("Are you sure? This wipes everything.")) {
            localStorage.removeItem(CONFIG.version);
            location.reload();
          }
        }
      }

      // --- UI MANAGER ---
      class UIManager {
        constructor() {
          this.els = {};
          this.particlePool = [];
          this.maxParticles = 50;
        }

        init() {
          this.els.score = document.getElementById('score');
          this.els.cps = document.getElementById('cps');
          this.els.buildingList = document.getElementById('building-list');
          this.els.upgradeList = document.getElementById('upgrade-list');
          this.els.particleLayer = document.getElementById('particle-layer');
          this.els.skinList = document.getElementById('skin-list');

          this.setupBuildings();
          this.setupInteractions();
          this.renderSkins();
          this.updateSkin();
        }

        setupBuildings() {
          this.els.buildingList.innerHTML = BUILDINGS.map(b => `
                <div class="building-card" id="b-card-${b.id}" onclick="Game.buyBuilding(${b.id})">
                    <div class="b-icon">${b.icon}</div>
                    <div class="b-info">
                        <div class="b-name">${b.name}</div>
                        <div class="b-cost" id="b-cost-${b.id}">0</div>
                    </div>
                    <div class="b-count" id="b-count-${b.id}">0</div>
                </div>
            `).join('');
        }

        setupInteractions() {
          const bigKlein = document.getElementById('big-klein');
          bigKlein.addEventListener('mousedown', (e) => {
            const power = Game.click();
            this.spawnClickText(e.clientX, e.clientY, `+${Utils.format(power)}`);
            bigKlein.style.transform = 'scale(0.95)';
            setTimeout(() => bigKlein.style.transform = 'scale(1)', 50);
          });
        }

        checkUnlocks() {
          // Render Upgrades
          const container = this.els.upgradeList;
          const available = UPGRADES.filter(u => {
            if (Game.state.upgrades.includes(u.id)) return false; // Already bought
            if (u.currency === 'chips') return false; // Handle prestige upgrades separately
            if (u.trigger.type === 'clicks' && Game.state.clicks >= u.trigger.val) return true;
            if (u.trigger.type === 'build' && Game.state.buildings[u.trigger.id] >= u.trigger.val) return true;
            return false;
          });

          // Simple diff check to avoid re-rendering constantly
          // For now, just clear and rebuild if count changes (optimization: use IDs)
          if (container.childElementCount !== available.length) {
            container.innerHTML = '';
            available.forEach(u => {
              const el = document.createElement('div');
              el.className = 'upgrade-item';
              el.innerHTML = u.icon;
              el.title = `${u.name}\n${u.desc}\nCost: ${Utils.format(u.cost)}`;
              el.onclick = () => { if (Game.buyUpgrade(u.id)) this.checkUnlocks(); };
              container.appendChild(el);
            });
          }
        }

        render() {
          this.els.score.textContent = Utils.format(Game.state.score);
          this.els.cps.textContent = `${Utils.format(Game.getCPS())} / sec`;

          BUILDINGS.forEach(b => {
            const cost = Game.getBuildingCost(b.id);
            const elCost = document.getElementById(`b-cost-${b.id}`);
            const elCount = document.getElementById(`b-count-${b.id}`);
            const card = document.getElementById(`b-card-${b.id}`);

            elCost.textContent = Utils.format(cost);
            elCount.textContent = Game.state.buildings[b.id];

            if (Game.state.score >= cost) {
              card.classList.add('can-afford');
              elCost.classList.add('affordable');
            } else {
              card.classList.remove('can-afford');
              elCost.classList.remove('affordable');
            }
          });

          // Prestige Modal Updates
          if (document.getElementById('modal-prestige').classList.contains('open')) {
            const gain = Game.getPrestigeGain();
            const btn = document.getElementById('prestige-btn-action');
            if (btn) {
              btn.textContent = `Ascend for +${gain} Levels`;
              btn.disabled = gain <= 0;
            }
          }
        }

        renderSkins() {
            if(!this.els.skinList) return;
            this.els.skinList.innerHTML = SKINS.map(s => {
                const owned = Game.state.skins.owned.includes(s.id);
                const equipped = Game.state.skins.equipped === s.id;
                return `
                    <div class="building-card ${equipped ? 'can-afford' : ''}" onclick="Game.equipSkin('${s.id}')" style="opacity:${owned ? 1 : 0.5}">
                        <div class="b-icon" style="filter:${s.filter}">üë§</div>
                        <div class="b-info">
                            <div class="b-name">${s.name}</div>
                            <div class="b-cost">${s.rarity.toUpperCase()}</div>
                        </div>
                        <div class="b-count">${equipped ? '‚úÖ' : (owned ? 'Owned' : 'Locked')}</div>
                    </div>
                `;
            }).join('');
        }

        updateSkin() {
            const s = SKINS.find(x => x.id === Game.state.skins.equipped);
            if(s) document.getElementById('big-klein').style.filter = `drop-shadow(0 20px 40px rgba(0,0,0,0.6)) ${s.filter}`;
            this.renderSkins();
        }

        spawnClickText(x, y, text) {
          const el = document.createElement('div');
          el.className = 'click-particle';
          el.textContent = text;
          el.style.left = (x - 20) + 'px';
          el.style.top = (y - 20) + 'px';
          this.els.particleLayer.appendChild(el);

          const angle = (Math.random() - 0.5) * 30;
          el.animate([
            { transform: `translate(0, 0) rotate(${angle}deg)`, opacity: 1 },
            { transform: `translate(0, -100px) rotate(${angle}deg)`, opacity: 0 }
          ], { duration: 800, easing: 'ease-out' }).onfinish = () => el.remove();
        }

        switchTab(tabName) {
          document.querySelectorAll('.panel-content').forEach(el => el.classList.add('hidden'));
          document.getElementById(`tab-${tabName}`).classList.remove('hidden');
          document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
          event.target.classList.add('active');
        }

        openModal(id) { document.getElementById(`modal-${id}`).classList.add('open'); }
        closeModals() { document.querySelectorAll('.modal-overlay').forEach(el => el.classList.remove('open')); }
      }

      // --- INSTANCES ---
      const Audio = new AudioManager();
      const Game = new GameEngine();
      const UI = new UIManager();

      // --- BOOT ---
      window.onload = () => {
        UI.init();
        Game.init();
      };
    </script>
  </body>

</html>