<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>KleinClicker Remastered</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      /* Helles, freundliches Farbschema */
      --primary: #6c5ce7;       /* Modernes Lila */
      --primary-dark: #5649c0;
      --secondary: #00cec9;     /* TÃ¼rkis */
      --accent: #fdcb6e;        /* Gold/Orange */
      --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      --panel-bg: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(255, 255, 255, 0.5);
      --text-main: #2d3436;
      --text-light: #636e72;
      --card-bg: #ffffff;
      --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-user-select: none; touch-action: manipulation; }
    
    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      height: 100vh;
      overflow: hidden; 
      display: grid;
      grid-template-rows: auto 1fr auto;
      position: relative;
    }

    /* --- Animations --- */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-12px); }
    }
    
    @keyframes popIn {
      0% { transform: scale(0); opacity: 0; }
      80% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes pulseGlow {
      0% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(108, 92, 231, 0); }
      100% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0); }
    }

    /* --- Header --- */
    header {
      padding: 15px;
      background: rgba(255,255,255,0.4);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      z-index: 10;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }

    h1 {
      font-family: 'Fredoka', sans-serif;
      font-size: 1.4rem;
      color: var(--primary);
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* --- Scoreboard --- */
    .scoreboard { text-align: center; }
    
    #score {
      font-family: 'Fredoka', sans-serif;
      font-size: 3rem;
      font-weight: 700;
      color: var(--text-main);
      line-height: 1;
      text-shadow: 2px 2px 0px rgba(255,255,255,1);
    }

    #cps {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--text-light);
      background: rgba(255,255,255,0.6);
      padding: 4px 12px;
      border-radius: 20px;
      margin-top: 5px;
      display: inline-block;
    }

    /* --- Level Bar (Modern) --- */
    .level-wrapper {
      width: 100%;
      max-width: 300px;
      margin-top: 5px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    
    .level-header {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      font-weight: bold;
      color: var(--primary);
    }

    .level-track {
      height: 8px;
      background: #dfe6e9;
      border-radius: 4px;
      overflow: hidden;
    }

    .level-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--secondary), var(--primary));
      transition: width 0.4s ease-out;
    }

    /* --- Game Area --- */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .click-zone {
      position: relative;
      cursor: pointer;
      z-index: 5;
      transition: transform 0.05s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .click-zone:active { transform: scale(0.95); }

    #klein {
      width: 240px;
      height: 240px;
      object-fit: contain;
      filter: drop-shadow(0 15px 25px rgba(0,0,0,0.15));
      animation: float 6s ease-in-out infinite;
    }

    /* --- Golden Klein --- */
    #goldenKlein {
      position: absolute;
      width: 70px;
      height: 70px;
      cursor: pointer;
      display: none; 
      z-index: 100;
      filter: drop-shadow(0 0 15px gold);
    }

    /* --- Floating Text --- */
    .click-text {
      position: absolute;
      font-family: 'Fredoka', sans-serif;
      font-weight: 700;
      color: var(--text-main);
      font-size: 1.5rem;
      pointer-events: none;
      z-index: 20;
      animation: flyUp 0.8s ease-out forwards;
      text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
    }
    @keyframes flyUp {
      0% { opacity: 1; transform: translateY(0) scale(0.8); }
      100% { opacity: 0; transform: translateY(-80px) scale(1.2); }
    }

    /* --- Bottom Panel (Shop) --- */
    .bottom-panel {
      height: 50vh;
      background: var(--panel-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top-left-radius: 24px;
      border-top-right-radius: 24px;
      border-top: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
      z-index: 50;
    }

    .tabs {
      display: flex;
      justify-content: center;
      padding: 15px 15px 5px 15px;
      gap: 15px;
    }

    .tab-btn {
      background: transparent;
      border: none;
      color: var(--text-light);
      font-family: 'Fredoka', sans-serif;
      font-size: 1.1rem;
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 12px;
      transition: all 0.2s;
      font-weight: 600;
    }

    .tab-btn.active {
      background: var(--card-bg);
      color: var(--primary);
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      scrollbar-width: thin;
    }

    /* --- UPGRADE STORE LAYOUT --- */
    /* 1. Tech Upgrades Row (Horizontal Scroll) */
    .tech-upgrade-container {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 10px;
      margin-bottom: 15px;
      min-height: 5px; /* Platzhalter */
    }
    
    .tech-item {
      flex: 0 0 auto;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #6c5ce7, #a29bfe);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(108, 92, 231, 0.3);
      position: relative;
      animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid white;
    }
    .tech-item:hover { transform: translateY(-3px); }
    
    /* Tooltip fÃ¼r Tech Items (simpel) */
    .tech-item::after {
      content: attr(data-cost);
      position: absolute;
      bottom: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.6rem;
      color: var(--text-main);
      background: rgba(255,255,255,0.8);
      padding: 2px 4px;
      border-radius: 4px;
      font-weight: bold;
      white-space: nowrap;
    }

    /* 2. Building List */
    .shop-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-bottom: 30px;
    }

    .shop-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 12px;
      display: grid;
      grid-template-columns: 50px 1fr auto;
      align-items: center;
      gap: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.03);
      border: 1px solid rgba(0,0,0,0.03);
      transition: transform 0.1s;
    }
    .shop-card:active { transform: scale(0.98); }

    .card-icon {
      width: 50px;
      height: 50px;
      background: #f1f2f6;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .card-info { display: flex; flex-direction: column; }
    .card-title { font-weight: 700; font-size: 1rem; color: var(--text-main); }
    .card-stats { font-size: 0.75rem; color: var(--text-light); }
    .card-stats strong { color: var(--secondary); }

    .card-buy {
      text-align: right;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 5px;
    }

    .price-tag {
      font-weight: 700;
      color: var(--primary);
      font-size: 0.9rem;
    }

    .count-badge {
      background: var(--text-main);
      color: #fff;
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: bold;
    }
    
    /* Disabled State */
    .shop-card.disabled { opacity: 0.6; filter: grayscale(0.8); cursor: not-allowed; }
    .shop-card.disabled .price-tag { color: #b2bec3; }

    /* --- Toasts --- */
    .toast-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 350px;
      z-index: 2000;
      pointer-events: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .toast {
      background: rgba(45, 52, 54, 0.95);
      color: #fff;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      font-size: 0.9rem;
      animation: slideDown 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .toast-icon { font-size: 1.2rem; }
    @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* Mobile Tweaks */
    @media (max-width: 600px) {
      #klein { width: 200px; height: 200px; }
      #score { font-size: 2.5rem; }
      .bottom-panel { height: 55vh; }
    }
  </style>
</head>
<body>

  <div class="toast-container" id="toastArea"></div>

  <!-- Tricky Golden Klein -->
  <img src="https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png" id="goldenKlein" alt="GOLDEN">

  <header>
    <h1>KleinClicker</h1>
    
    <div class="level-wrapper">
      <div class="level-header">
        <span id="rankName">AnfÃ¤nger</span>
        <span>Lvl <span id="lvlNum">1</span></span>
      </div>
      <div class="level-track">
        <div class="level-fill" id="levelBar"></div>
      </div>
    </div>

    <div class="scoreboard">
      <div id="score">0</div>
      <div id="cps">0.0 / Sek</div>
    </div>
  </header>

  <main>
    <div class="click-zone" id="clickArea">
      <img src="https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png" alt="Klein" id="klein">
    </div>
  </main>

  <div class="bottom-panel">
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('shop')">Shop</button>
      <button class="tab-btn" onclick="switchTab('achievements')">Erfolge</button>
      <button class="tab-btn" onclick="hardReset()" style="color:var(--primary)">Reset</button>
    </div>

    <div class="panel-content" id="panelShop">
      <!-- 1. Tech Upgrades (Icons) -->
      <div class="tech-upgrade-container" id="techGrid">
        <!-- GefÃ¼llt via JS -->
      </div>

      <!-- 2. Buildings (List) -->
      <div class="shop-list" id="buildingGrid">
        <!-- GefÃ¼llt via JS -->
      </div>
    </div>

    <div class="panel-content" id="panelAchievements" style="display:none;">
      <div class="shop-list" id="achievementsGrid"></div>
    </div>
  </div>

  <script>
    /* --- CONFIGURATION --- */
    const SAVE_KEY = 'KleinClickerRemaster_v3';
    
    // Buildings: Basic Stats
    const BUILDINGS = [
      { id: 0, name: 'Kaputte Maus', baseCps: 0.2, baseCost: 15,   icon: 'ðŸ–±ï¸', count: 0 },
      { id: 1, name: 'Praktikant',   baseCps: 1,   baseCost: 100,  icon: 'ðŸ§‘â€ðŸ’»', count: 0 },
      { id: 2, name: 'Oma',          baseCps: 5,   baseCost: 500,  icon: 'ðŸ‘µ', count: 0 },
      { id: 3, name: 'Hofladen',     baseCps: 20,  baseCost: 2000, icon: 'ðŸ¥•', count: 0 },
      { id: 4, name: 'Fabrik',       baseCps: 80,  baseCost: 8000, icon: 'ðŸ­', count: 0 },
      { id: 5, name: 'Serverfarm',   baseCps: 250, baseCost: 40000, icon: 'ðŸ’»', count: 0 },
      { id: 6, name: 'KI-System',    baseCps: 1000,baseCost: 200000,icon: 'ðŸ¤–', count: 0 }
    ];

    // Tech Upgrades: Make buildings better!
    // targetId = Index in BUILDINGS array
    // trigger = How many buildings needed to see this upgrade
    const TECH_UPGRADES = [
      { id: 'tech_mouse_1', name: 'Mausrad Ã¶len',       targetId: 0, multi: 2, cost: 250,    trigger: 10, icon: 'âš™ï¸', bought: false, desc: 'MÃ¤use sind doppelt so effizient.' },
      { id: 'tech_mouse_2', name: 'Bluetooth Maus',     targetId: 0, multi: 2, cost: 1000,   trigger: 25, icon: 'ðŸ“¶', bought: false, desc: 'MÃ¤use sind doppelt so effizient.' },
      { id: 'tech_prak_1',  name: 'Kostenloser Kaffee', targetId: 1, multi: 2, cost: 2500,   trigger: 10, icon: 'â˜•', bought: false, desc: 'Praktikanten arbeiten hÃ¤rter.' },
      { id: 'tech_oma_1',   name: 'Lesebrille',         targetId: 2, multi: 2, cost: 10000,  trigger: 10, icon: 'ðŸ‘“', bought: false, desc: 'Omas klicken genauer.' },
      { id: 'tech_all_1',   name: 'Goldener Klick',     targetId: -1,multi: 1.1, cost: 50000,trigger: 0,  icon: 'ðŸŒŸ', bought: false, desc: '+10% auf ALLES (benÃ¶tigt 5.000 Punkte).' }, // Special
      { id: 'tech_mouse_3', name: 'Gaming Maus',        targetId: 0, multi: 4, cost: 50000,  trigger: 50, icon: 'ðŸŽ®', bought: false, desc: 'MÃ¤use x4!' }
    ];

    const RANKS = ["Zivilist", "AnfÃ¤nger", "Fortgeschrittener", "Experte", "Meister", "Legende", "Klein-Gott"];

    /* --- STATE --- */
    let game = {
      score: 0,
      xp: 0,
      totalClicks: 0,
      buildings: JSON.parse(JSON.stringify(BUILDINGS)), // Deep copy
      techs: JSON.parse(JSON.stringify(TECH_UPGRADES))
    };

    let lastTick = performance.now();
    let goldenActive = false;

    /* --- DOM --- */
    const els = {
      score: document.getElementById('score'),
      cps: document.getElementById('cps'),
      techGrid: document.getElementById('techGrid'),
      buildGrid: document.getElementById('buildingGrid'),
      clickArea: document.getElementById('clickArea'),
      klein: document.getElementById('klein'),
      golden: document.getElementById('goldenKlein'),
      levelBar: document.getElementById('levelBar'),
      lvlNum: document.getElementById('lvlNum'),
      rankName: document.getElementById('rankName')
    };

    /* --- INIT --- */
    function init() {
      loadGame();
      // UI Loop
      requestAnimationFrame(gameLoop);
      // Logic Loop (Save & Golden)
      setInterval(saveGame, 5000);
      scheduleGolden();
      renderShop(); // First render
    }

    /* --- GAME LOOP --- */
    function gameLoop(now) {
      let dt = (now - lastTick) / 1000;
      if (dt > 1) dt = 1;
      lastTick = now;

      // Passive Income
      const cps = calculateTotalCPS();
      if (cps > 0) {
        addScore(cps * dt);
      }

      updateUI(cps);
      requestAnimationFrame(gameLoop);
    }

    /* --- CALCULATIONS --- */
    function getBuildingCPS(index) {
      const b = game.buildings[index];
      let multiplier = 1;

      // Check Tech Upgrades for this building
      game.techs.filter(t => t.bought && t.targetId === index).forEach(t => {
        multiplier *= t.multi;
      });

      // Global Bonus (targetId -1)
      game.techs.filter(t => t.bought && t.targetId === -1).forEach(t => {
        multiplier *= t.multi;
      });

      // Level Bonus (1% per level)
      const lvl = getLevelData().level;
      multiplier *= (1 + (lvl * 0.01));

      return b.baseCps * multiplier;
    }

    function calculateTotalCPS() {
      return game.buildings.reduce((sum, b, index) => {
        return sum + (b.count * getBuildingCPS(index));
      }, 0);
    }

    function getBuildingCost(b) {
      return Math.floor(b.baseCost * Math.pow(1.15, b.count));
    }

    function getClickPower() {
      const cps = calculateTotalCPS();
      // Click ist 1 + 5% vom CPS. Das macht Klicks immer relevant.
      return 1 + (cps * 0.05);
    }

    /* --- LEVEL SYSTEM --- */
    function getLevelData() {
      // XP Curve: 500 * 1.5 ^ Level
      let level = 1;
      let req = 500;
      let current = game.xp;
      
      while (current >= req) {
        current -= req;
        level++;
        req *= 1.5;
      }
      return { level, current, req };
    }

    function addScore(amount) {
      game.score += amount;
      game.xp += amount;
    }

    /* --- INTERACTION --- */
    els.clickArea.addEventListener('mousedown', (e) => handleClick(e.clientX, e.clientY));
    els.clickArea.addEventListener('touchstart', (e) => {
      e.preventDefault();
      for(let i=0; i<e.touches.length; i++) handleClick(e.touches[i].clientX, e.touches[i].clientY);
    }, {passive:false});

    function handleClick(x, y) {
      const power = getClickPower();
      addScore(power);
      game.totalClicks++;

      // Visuals
      createFloatText(x, y, `+${formatNum(power)}`);
      els.klein.style.transform = 'scale(0.95)';
      setTimeout(() => els.klein.style.transform = '', 50);
    }

    /* --- SHOP LOGIC --- */
    function buyBuilding(index) {
      const b = game.buildings[index];
      const cost = getBuildingCost(b);
      
      if(game.score >= cost) {
        game.score -= cost;
        b.count++;
        // Render triggers tech update
        renderShop();
      }
    }

    function buyTech(techId) {
      const tech = game.techs.find(t => t.id === techId);
      if(tech && !tech.bought && game.score >= tech.cost) {
        game.score -= tech.cost;
        tech.bought = true;
        showToast("Upgrade installiert!", tech.name);
        renderShop();
      }
    }

    /* --- RENDERING --- */
    // Wir rendern nicht jeden Frame neu, das wÃ¤re ineffizient. 
    // Wir aktualisieren nur Preise/Disabled status im Loop, aber DOM Struktur hier:
    function renderShop() {
      renderTechSection();
      renderBuildingSection();
    }

    function renderTechSection() {
      els.techGrid.innerHTML = '';
      
      const availableTechs = game.techs.filter(t => !t.bought && checkTechUnlock(t));
      
      if(availableTechs.length === 0) {
        els.techGrid.style.display = 'none';
        return;
      }
      els.techGrid.style.display = 'flex';

      availableTechs.forEach(t => {
        const el = document.createElement('div');
        el.className = 'tech-item';
        el.innerHTML = t.icon;
        el.dataset.cost = formatNum(t.cost);
        el.onclick = () => buyTech(t.id);
        
        // Simple visual feedback if affordable handled in UI update
        el.id = `tech-${t.id}`;
        
        els.techGrid.appendChild(el);
      });
    }

    function checkTechUnlock(tech) {
      // Special Tech: Global Bonus at 5000 score
      if (tech.targetId === -1) return game.totalClicks > 100 && game.xp > 5000;
      // Normal Tech: based on building count
      return game.buildings[tech.targetId].count >= tech.trigger;
    }

    function renderBuildingSection() {
      els.buildGrid.innerHTML = '';
      game.buildings.forEach((b, i) => {
        const currentCps = getBuildingCPS(i); // Actual CPS per unit
        
        const el = document.createElement('div');
        el.className = 'shop-card';
        el.id = `build-card-${i}`;
        el.onclick = () => buyBuilding(i);
        el.innerHTML = `
          <div class="card-icon">${b.icon}</div>
          <div class="card-info">
            <span class="card-title">${b.name}</span>
            <span class="card-stats">
              Produziert <strong>${formatNum(currentCps)}</strong> / Sek
            </span>
          </div>
          <div class="card-buy">
            <span class="price-tag" id="cost-${i}">ðŸ’Ž ${formatNum(getBuildingCost(b))}</span>
            <span class="count-badge">${b.count}</span>
          </div>
        `;
        els.buildGrid.appendChild(el);
      });
    }

    /* --- UI UPDATES (High Frequency) --- */
    function updateUI(currentTotalCPS) {
      els.score.textContent = formatNum(Math.floor(game.score));
      els.cps.textContent = formatNum(currentTotalCPS.toFixed(1)) + " / Sek";

      // Level
      const lvlData = getLevelData();
      els.lvlNum.textContent = lvlData.level;
      const rankIdx = Math.min(Math.floor((lvlData.level - 1) / 5), RANKS.length - 1);
      els.rankName.textContent = RANKS[rankIdx];
      const pct = Math.min(100, (lvlData.current / lvlData.req) * 100);
      els.levelBar.style.width = pct + "%";

      // Update Building Costs & Enable States
      game.buildings.forEach((b, i) => {
        const card = document.getElementById(`build-card-${i}`);
        const costEl = document.getElementById(`cost-${i}`);
        if(card && costEl) {
          const cost = getBuildingCost(b);
          costEl.textContent = "ðŸ’Ž " + formatNum(cost);
          if (game.score >= cost) {
            card.classList.remove('disabled');
          } else {
            card.classList.add('disabled');
          }
        }
      });

      // Update Tech Upgrades visual state
      const availableTechs = game.techs.filter(t => !t.bought && checkTechUnlock(t));
      // Re-render if new tech unlocked (simple check: visible count diff)
      if(els.techGrid.children.length !== availableTechs.length) {
        renderTechSection();
      }

      availableTechs.forEach(t => {
        const el = document.getElementById(`tech-${t.id}`);
        if(el) {
          el.style.opacity = game.score >= t.cost ? '1' : '0.5';
          el.style.filter = game.score >= t.cost ? 'none' : 'grayscale(1)';
        }
      });
    }

    /* --- GOLDEN KLEIN (The same fun logic) --- */
    function scheduleGolden() {
      const delay = (Math.random() * 120000) + 60000; // 1-3 min
      setTimeout(spawnGolden, delay);
    }

    function spawnGolden() {
      const g = els.golden;
      const x = Math.random() * (window.innerWidth - 80);
      const y = Math.random() * (window.innerHeight - 300);
      g.style.left = x + 'px';
      g.style.top = y + 'px';
      g.style.display = 'block';
      goldenActive = true;
      
      // Auto hide
      setTimeout(() => {
        if(goldenActive) {
          g.style.display = 'none';
          goldenActive = false;
          scheduleGolden();
        }
      }, 6000);
    }

    els.golden.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        goldenClick();
    });
    els.golden.addEventListener('touchstart', (e) => {
        e.stopPropagation(); e.preventDefault(); goldenClick();
    });

    function goldenClick() {
      if(!goldenActive) return;
      goldenActive = false;
      els.golden.style.display = 'none';
      
      const cps = calculateTotalCPS();
      const reward = Math.max(500, cps * 60); // Min 500 or 60sec production
      addScore(reward);
      
      showToast("ðŸŒŸ GOLDENER KLEIN", `+${formatNum(Math.floor(reward))} Punkte!`);
      scheduleGolden();
    }

    /* --- UTILS --- */
    function formatNum(num) {
      if(num >= 1000000) return (num/1000000).toFixed(2) + "M";
      if(num >= 1000) return (num/1000).toFixed(1) + "k";
      if(num % 1 !== 0) return num.toFixed(1);
      return num;
    }

    function createFloatText(x, y, text) {
      const el = document.createElement('div');
      el.className = 'click-text';
      el.textContent = text;
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 800);
    }

    function showToast(title, msg) {
      const t = document.createElement('div');
      t.className = 'toast';
      t.innerHTML = `<span class="toast-icon">âœ…</span><div><strong>${title}</strong><br>${msg}</div>`;
      document.getElementById('toastArea').appendChild(t);
      setTimeout(() => t.remove(), 3000);
    }

    function switchTab(t) {
      document.getElementById('panelShop').style.display = (t==='shop')?'block':'none';
      document.getElementById('panelAchievements').style.display = (t==='achievements')?'block':'none';
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
    }

    /* --- SAVE/LOAD --- */
    function saveGame() {
      localStorage.setItem(SAVE_KEY, JSON.stringify(game));
    }
    
    function loadGame() {
      const saved = localStorage.getItem(SAVE_KEY);
      if(saved) {
        try {
          const data = JSON.parse(saved);
          game.score = data.score || 0;
          game.xp = data.xp || 0;
          game.totalClicks = data.totalClicks || 0;
          
          // Merge Arrays intelligently to allow updates
          if(data.buildings) {
            data.buildings.forEach((savedB, i) => {
              if(game.buildings[i]) game.buildings[i].count = savedB.count;
            });
          }
          if(data.techs) {
            data.techs.forEach(savedT => {
              const match = game.techs.find(t => t.id === savedT.id);
              if(match) match.bought = savedT.bought;
            });
          }
        } catch(e) { console.error("Save error", e); }
      }
    }

    window.hardReset = function() {
        if(confirm("Wirklich alles lÃ¶schen?")) {
            localStorage.removeItem(SAVE_KEY);
            location.reload();
        }
    }

    init();
  </script>
</body>
</html>
