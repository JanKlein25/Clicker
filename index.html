<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>KleinClicker HARDCORE</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #d63031; /* Aggressiveres Rot */
      --secondary: #0984e3;
      --gold: #fdcb6e;
      --dark-overlay: rgba(0, 0, 0, 0.9);
      --bg-gradient: radial-gradient(circle at center, #2d3436 0%, #000000 100%); /* Dunklerer Hintergrund */
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-color: #dfe6e9;
      --level-bar-height: 8px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-user-select: none; touch-action: manipulation; }
    
    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-color);
      height: 100vh;
      overflow: hidden; 
      display: grid;
      grid-template-rows: auto 1fr auto;
      position: relative;
    }

    /* --- Animations --- */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes shake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      10% { transform: translate(-1px, -2px) rotate(-1deg); }
      20% { transform: translate(-3px, 0px) rotate(1deg); }
      30% { transform: translate(3px, 2px) rotate(0deg); }
      40% { transform: translate(1px, -1px) rotate(1deg); }
      50% { transform: translate(-1px, 2px) rotate(-1deg); }
      60% { transform: translate(-3px, 1px) rotate(0deg); }
      70% { transform: translate(3px, 1px) rotate(-1deg); }
      80% { transform: translate(-1px, -1px) rotate(1deg); }
      90% { transform: translate(1px, 2px) rotate(0deg); }
      100% { transform: translate(1px, -2px) rotate(-1deg); }
    }

    @keyframes barStripe {
      0% { background-position: 40px 0; }
      100% { background-position: 0 0; }
    }

    /* --- UI Elements --- */
    header {
      text-align: center;
      padding: 15px;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(10px);
      z-index: 100;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    /* --- HARDCORE LEVEL SYSTEM STYLES --- */
    .level-container {
      width: 100%;
      max-width: 350px;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #444;
      position: relative;
    }

    .level-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 0.8rem;
      font-family: 'Fredoka', sans-serif;
    }

    .rank-name {
      color: var(--secondary);
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .level-bar-bg {
      width: 100%;
      height: var(--level-bar-height);
      background: #2d3436;
      border-radius: 4px;
      overflow: hidden;
    }

    .level-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--secondary), #74b9ff);
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 10px var(--secondary);
    }

    h1 {
      font-family: 'Fredoka', sans-serif;
      font-size: 1.2rem;
      color: #636e72;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .scoreboard { display: flex; flex-direction: column; align-items: center; width: 100%; }

    #score {
      font-family: 'Fredoka', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 0 10px rgba(255,255,255,0.2);
      margin-top: 5px;
    }

    #cps {
      font-size: 0.8rem;
      color: #b2bec3;
      margin-top: -5px;
    }

    /* --- Game Area --- */
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .click-zone {
      position: relative;
      cursor: pointer;
      z-index: 10;
      transition: transform 0.05s;
    }
    
    .click-zone:active { transform: scale(0.97); }

    #klein {
      width: 220px;
      height: 220px;
      object-fit: contain;
      filter: drop-shadow(0 0 20px rgba(0,0,0,0.8));
      animation: float 5s ease-in-out infinite;
      transition: filter 0.2s;
    }
    
    #klein:hover {
        filter: drop-shadow(0 0 30px rgba(255, 107, 107, 0.4));
    }

    /* --- Tricky Golden Klein --- */
    #goldenKlein {
      position: absolute;
      width: 60px;
      height: 60px;
      cursor: crosshair;
      display: none; 
      z-index: 999;
      filter: drop-shadow(0 0 10px gold);
      transition: top 0.1s, left 0.1s; /* Fast teleport */
    }

    /* --- Particles --- */
    .click-text {
      position: absolute;
      font-family: 'Fredoka', sans-serif;
      font-weight: bold;
      color: #fff;
      font-size: 1.2rem;
      pointer-events: none;
      z-index: 20;
      animation: flyUp 0.8s ease-out forwards;
      text-shadow: 0 2px 4px #000;
    }
    
    @keyframes flyUp {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-50px) scale(1.2); }
    }

    /* --- Shop & Tabs --- */
    .bottom-panel {
      height: 45vh;
      background: rgba(10, 10, 10, 0.95);
      border-top: 2px solid #333;
      display: flex;
      flex-direction: column;
      z-index: 100;
      box-shadow: 0 -5px 20px rgba(0,0,0,0.8);
    }

    .tabs {
      display: flex;
      justify-content: center;
      background: #1e272e;
    }

    .tab-btn {
      flex: 1;
      background: transparent;
      border: none;
      color: #808e9b;
      font-family: 'Fredoka', sans-serif;
      font-size: 1rem;
      padding: 12px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }

    .tab-btn.active { color: #fff; background: #2d3436; border-bottom: 3px solid var(--primary); }

    .panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      scrollbar-width: thin;
      scrollbar-color: #555 #222;
    }

    .shop-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding-bottom: 20px;
    }

    .shop-item {
      display: grid;
      grid-template-columns: 50px 1fr auto auto;
      align-items: center;
      background: #2d3436;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 8px 12px;
      gap: 10px;
    }

    .item-icon { font-size: 1.8rem; display:flex; justify-content:center; }
    
    .item-info { display: flex; flex-direction: column; }
    .item-name { font-weight: 700; font-size: 0.95rem; color: #fff; }
    .item-cps { font-size: 0.75rem; color: #74b9ff; }
    
    .item-cost-area { text-align: right; }
    .item-cost { color: var(--gold); font-weight: bold; font-size: 0.9rem; display: block; }
    .item-count { font-size: 1.2rem; font-weight: bold; color: #636e72; padding: 0 10px;}

    .item-btn {
      background: var(--primary);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
      font-size: 0.8rem;
      transition: opacity 0.2s;
    }
    .item-btn:disabled { background: #444; color: #888; cursor: not-allowed; }

    /* --- Notification --- */
    .toast-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2000;
      pointer-events: none;
      width: 80%;
      max-width: 300px;
    }
    .toast {
      background: #fff;
      color: #000;
      padding: 10px 15px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      margin-bottom: 10px;
      font-weight: bold;
      animation: slideInDown 0.3s forwards;
    }
    @keyframes slideInDown { from { transform: translateY(-20px); opacity:0; } to { transform: translateY(0); opacity:1; } }

    /* --- Mobile Tweak --- */
    @media (max-width: 600px) {
      #klein { width: 180px; height: 180px; }
      h1 { font-size: 1rem; }
      #score { font-size: 2rem; }
    }
  </style>
</head>
<body>

  <div class="toast-container" id="toastArea"></div>

  <!-- Tricky Golden Klein -->
  <img src="https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png" id="goldenKlein" alt="GOLDEN">

  <header>
    <h1>KleinClicker <span style="color:var(--primary)">HARDCORE</span></h1>
    
    <div class="level-container">
      <div class="level-info">
        <div>
          <span style="color:#aaa">Rang:</span> 
          <span class="rank-name" id="rankName">Zivilist</span>
        </div>
        <div style="font-weight:bold; color:#fff">Lvl <span id="lvlNum">1</span></div>
      </div>
      <div class="level-bar-bg">
        <div class="level-bar-fill" id="levelBar"></div>
      </div>
      <div style="text-align:right; font-size:0.7rem; color:#666; margin-top:2px;">
        <span id="progressXP">0</span>% zum Aufstieg
      </div>
    </div>

    <div class="scoreboard">
      <div id="score">0</div>
      <div id="cps">0.0 CPS</div>
    </div>
  </header>

  <main>
    <div class="click-zone" id="clickArea">
      <img src="https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png" alt="Klein" id="klein">
    </div>
  </main>

  <div class="bottom-panel">
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('shop')">MARKT</button>
      <button class="tab-btn" onclick="switchTab('achievements')">ERFOLGE</button>
      <button class="tab-btn" onclick="hardReset()" style="color:var(--primary)">WIPE</button>
    </div>

    <div class="panel-content" id="panelShop">
      <div class="shop-grid" id="shopGrid"></div>
    </div>

    <div class="panel-content" id="panelAchievements" style="display:none;">
      <div class="shop-grid" id="achievementsGrid"></div>
    </div>
  </div>

  <script>
    /* --- CONFIGURATION --- */
    const SAVE_KEY = 'KleinClickerHC_v1';
    
    // H√§rteres Balancing: Teurer, weniger Ertrag
    const UPGRADE_DATA = [
      { id: 'u1', name: 'Schlechte Maus',   baseCost: 25,      baseCPS: 0.2,   icon: 'üñ±Ô∏è' },
      { id: 'u2', name: 'Praktikant',       baseCost: 250,     baseCPS: 1.5,   icon: 'üë®‚Äçüéì' },
      { id: 'u3', name: 'Oma',              baseCost: 1200,    baseCPS: 5,     icon: 'üëµ' },
      { id: 'u4', name: 'Farm',             baseCost: 8500,    baseCPS: 20,    icon: 'üöú' },
      { id: 'u5', name: 'Fabrik',           baseCost: 55000,   baseCPS: 85,    icon: 'üè≠' },
      { id: 'u6', name: 'Meme-Mine',        baseCost: 400000,  baseCPS: 350,   icon: '‚õèÔ∏è' },
      { id: 'u7', name: 'Klon-Labor',       baseCost: 2500000, baseCPS: 1200,  icon: 'üß™' },
      { id: 'u8', name: 'Klein-Imperium',   baseCost: 20000000,baseCPS: 6000,  icon: 'üëë' }
    ];

    const RANKS = [
      "Niemand", "Anf√§nger", "M√∂chtegern", "Klicker", 
      "Arbeiter", "Manager", "Boss", "Baron", 
      "Tycoon", "Monopolist", "Illuminati", "Klein-Gott"
    ];

    /* --- GAME STATE --- */
    let game = {
      score: 0,
      xp: 0, // Separate XP! Score ausgeben verringert XP nicht.
      clickCount: 0,
      startTime: Date.now(),
      upgrades: new Array(UPGRADE_DATA.length).fill(0), // speichert Anzahl
      achievements: [] // speichert IDs
    };

    let goldenActive = false;
    let goldenClickCount = 0; // F√ºr das Minigame
    let lastTick = performance.now();

    /* --- DOM ELEMENTS --- */
    const els = {
      score: document.getElementById('score'),
      cps: document.getElementById('cps'),
      lvlNum: document.getElementById('lvlNum'),
      rankName: document.getElementById('rankName'),
      levelBar: document.getElementById('levelBar'),
      progressXP: document.getElementById('progressXP'),
      clickArea: document.getElementById('clickArea'),
      klein: document.getElementById('klein'),
      golden: document.getElementById('goldenKlein'),
      shopGrid: document.getElementById('shopGrid'),
      achieveGrid: document.getElementById('achievementsGrid')
    };

    /* --- INITIALIZATION --- */
    function init() {
      loadGame();
      renderShop();
      requestAnimationFrame(gameLoop);
      setInterval(saveGame, 5000);
      scheduleGolden();
    }

    /* --- CORE LOOP --- */
    function gameLoop(now) {
      let dt = (now - lastTick) / 1000;
      if (dt > 1) dt = 1; // Lag prevention
      lastTick = now;

      const cps = getCPS();
      if (cps > 0) {
        addScore(cps * dt);
      }
      
      updateUI();
      requestAnimationFrame(gameLoop);
    }

    /* --- MATH & LOGIC --- */
    function getCPS() {
      let cps = 0;
      game.upgrades.forEach((count, i) => {
        cps += count * UPGRADE_DATA[i].baseCPS;
      });
      // Globaler Level Multiplikator (Viel schw√§cher: nur 2% pro Level)
      const lvl = getLevel();
      const multiplier = 1 + (lvl * 0.02); 
      return cps * multiplier;
    }

    function getClickPower() {
      // Basis 1, skaliert schwach mit CPS
      const cps = getCPS();
      // Man bekommt 3% des CPS pro Klick, mindestens 1
      return 1 + (cps * 0.03);
    }

    function getUpgradeCost(index) {
      const base = UPGRADE_DATA[index].baseCost;
      const count = game.upgrades[index];
      // STEEPER CURVE: 1.3x statt 1.15x
      return Math.floor(base * Math.pow(1.3, count));
    }

    // EXPONENTIAL LEVEL SYSTEM
    // Level 1 braucht 500 XP
    // Level 2 braucht 500 * 1.5 = 750 (Total 1250)
    // Level 3 braucht 750 * 1.5 ...
    function getLevelInfo() {
      let level = 1;
      let req = 500;
      let currentXP = game.xp;
      
      while (currentXP >= req) {
        currentXP -= req;
        level++;
        req = Math.floor(req * 1.6); // Jedes Level wird 60% h√§rter!
      }
      
      return { level, current: currentXP, req };
    }

    function getLevel() {
      return getLevelInfo().level;
    }

    function getRank(lvl) {
      const idx = Math.min(Math.floor((lvl - 1) / 5), RANKS.length - 1);
      return RANKS[idx];
    }

    function addScore(amount) {
      game.score += amount;
      game.xp += amount; // XP wachsen immer mit Score
    }

    /* --- INTERACTION --- */
    els.clickArea.addEventListener('mousedown', (e) => handleClick(e.clientX, e.clientY));
    els.clickArea.addEventListener('touchstart', (e) => {
      e.preventDefault();
      for(let i=0; i<e.touches.length; i++) {
        handleClick(e.touches[i].clientX, e.touches[i].clientY);
      }
    }, {passive:false});

    function handleClick(x, y) {
      const amount = getClickPower();
      addScore(amount);
      game.clickCount++;

      // Visuals
      createFloatText(x, y, `+${Math.floor(amount)}`);
      els.klein.style.transform = 'scale(0.95)';
      setTimeout(() => els.klein.style.transform = '', 50);
    }

    /* --- GOLDEN KLEIN (TRICKY VERSION) --- */
    function scheduleGolden() {
      // Viel seltener: zwischen 2 und 5 Minuten
      const delay = (Math.random() * 180000) + 120000;
      setTimeout(spawnGolden, delay);
    }

    function spawnGolden() {
      goldenClickCount = 0; // Reset
      const g = els.golden;
      moveGoldenRandomly();
      g.style.display = 'block';
      goldenActive = true;

      // Verschwindet nach 7 Sekunden von selbst
      const timer = setTimeout(() => {
        if(goldenActive) {
          g.style.display = 'none';
          goldenActive = false;
          scheduleGolden();
        }
      }, 7000);
      
      // Speichere Timer ID am Element um ihn bei Klick zu l√∂schen
      g.dataset.timer = timer;
    }

    function moveGoldenRandomly() {
      const x = Math.random() * (window.innerWidth - 80);
      const y = Math.random() * (window.innerHeight - 200); // Nicht √ºber Shop
      els.golden.style.left = x + 'px';
      els.golden.style.top = y + 'px';
    }

    els.golden.addEventListener('mousedown', (e) => {
      e.stopPropagation();
      goldenInteraction();
    });
    
    // F√ºr Touch Ger√§te
    els.golden.addEventListener('touchstart', (e) => {
        e.stopPropagation();
        e.preventDefault();
        goldenInteraction();
    });

    function goldenInteraction() {
        if (!goldenActive) return;

        // Mechanik: Beim ersten Klick teleportiert er sich weg! (50% Chance)
        if (goldenClickCount === 0 && Math.random() > 0.4) {
            goldenClickCount++;
            moveGoldenRandomly();
            showToast("‚ö†Ô∏è Hoppla!", "Er ist ausgewichen!");
            return;
        }

        // Erfolg!
        goldenActive = false;
        clearTimeout(els.golden.dataset.timer);
        els.golden.style.display = 'none';

        // Reward Calculation
        const cps = getCPS();
        let reward = 0;
        let msg = "";

        // 10% Chance auf Jackpot, sonst Standard
        if (Math.random() < 0.1) {
            reward = (cps * 120) + 1000; // 2 Minuten Produktion
            msg = "JACKPOT! Mega Bonus!";
        } else {
            reward = (cps * 30) + 100; // 30 Sekunden Produktion
            msg = "Bonus Punkte!";
        }

        addScore(reward);
        showToast("üåü GEFANGEN!", `${msg} +${Math.floor(reward)}`);
        
        scheduleGolden();
    }


    /* --- SHOP SYSTEM --- */
    function renderShop() {
      els.shopGrid.innerHTML = '';
      UPGRADE_DATA.forEach((u, i) => {
        const cost = getUpgradeCost(i);
        const count = game.upgrades[i];
        
        const el = document.createElement('div');
        el.className = 'shop-item';
        el.innerHTML = `
          <div class="item-icon">${u.icon}</div>
          <div class="item-info">
            <span class="item-name">${u.name}</span>
            <span class="item-cps">+${u.baseCPS} CPS</span>
          </div>
          <div class="item-cost-area">
             <span class="item-cost">${formatNumber(cost)}</span>
          </div>
          <button class="item-btn" id="btn-${i}" onclick="buyUpgrade(${i})">KAUFEN</button>
        `;
        els.shopGrid.appendChild(el);
      });
    }

    window.buyUpgrade = function(index) {
      const cost = getUpgradeCost(index);
      if (game.score >= cost) {
        game.score -= cost;
        game.upgrades[index]++;
        renderShop();
        updateUI();
        
        // Button Feedback
        const btn = document.getElementById(`btn-${index}`);
        btn.textContent = "OK!";
        setTimeout(()=>btn.textContent="KAUFEN", 500);
      }
    }

    /* --- UI UPDATE --- */
    function updateUI() {
      // Score Formatting
      els.score.textContent = formatNumber(Math.floor(game.score));
      els.cps.textContent = formatNumber(getCPS().toFixed(1)) + " / Sek";

      // Level UI
      const info = getLevelInfo();
      els.lvlNum.textContent = info.level;
      els.rankName.textContent = getRank(info.level);
      
      const pct = Math.min(100, (info.current / info.req) * 100);
      els.levelBar.style.width = pct + "%";
      els.progressXP.textContent = Math.floor(pct);

      // Buttons enable/disable
      UPGRADE_DATA.forEach((u, i) => {
        const btn = document.getElementById(`btn-${i}`);
        if(btn) {
          const cost = getUpgradeCost(i);
          btn.disabled = game.score < cost;
          btn.style.opacity = game.score < cost ? 0.5 : 1;
        }
      });
    }

    function createFloatText(x, y, txt) {
      const el = document.createElement('div');
      el.className = 'click-text';
      el.textContent = txt;
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 800);
    }

    function showToast(title, msg) {
      const t = document.createElement('div');
      t.className = 'toast';
      t.innerHTML = `<div style="font-size:0.9rem; color:var(--primary)">${title}</div><div>${msg}</div>`;
      document.getElementById('toastArea').appendChild(t);
      setTimeout(() => t.remove(), 2500);
    }

    function formatNumber(num) {
      if(num >= 1000000) return (num/1000000).toFixed(2) + "M";
      if(num >= 1000) return (num/1000).toFixed(1) + "k";
      return num;
    }

    /* --- SAVE SYSTEM --- */
    function saveGame() {
      localStorage.setItem(SAVE_KEY, JSON.stringify(game));
    }

    function loadGame() {
      const saved = localStorage.getItem(SAVE_KEY);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          // Merge save data carefully
          game.score = data.score || 0;
          game.xp = data.xp || 0;
          game.clickCount = data.clickCount || 0;
          if (data.upgrades) {
             data.upgrades.forEach((u, i) => {
               if (i < game.upgrades.length) game.upgrades[i] = u;
             });
          }
        } catch (e) { console.error("Corrupt Save"); }
      }
    }

    window.hardReset = function() {
      if (confirm("Dies setzt ALLES zur√ºck. Dein Fortschritt wird gel√∂scht.")) {
        localStorage.removeItem(SAVE_KEY);
        location.reload();
      }
    }

    window.switchTab = function(t) {
      document.getElementById('panelShop').style.display = 'none';
      document.getElementById('panelAchievements').style.display = 'none';
      
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');

      if(t==='shop') document.getElementById('panelShop').style.display='block';
      if(t==='achievements') document.getElementById('panelAchievements').style.display='block';
    }

    init();
  </script>
</body>
</html>
