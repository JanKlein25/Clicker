<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>KleinClicker Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #ff6b6b;
      --primary-dark: #ee5253;
      --bg-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --text-color: #ffffff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-user-select: none; }
    
    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-color);
      min-height: 100vh;
      overflow-x: hidden;
      display: grid;
      grid-template-rows: auto 1fr auto; /* Header, Game, Footer */
    }

    /* --- Animations --- */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
    }
    
    @keyframes pop {
      0% { transform: scale(1); }
      50% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }

    @keyframes flyUp {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
    }

    /* --- UI Elements --- */
    header {
      text-align: center;
      padding: 20px;
      background: rgba(0,0,0,0.2);
      backdrop-filter: blur(5px);
      z-index: 100;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }

    h1 {
      font-family: 'Fredoka', sans-serif;
      font-size: 2.5rem;
      color: #fff;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    .scoreboard {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }

    #score {
      font-family: 'Fredoka', sans-serif;
      font-size: 3.5rem;
      font-weight: 700;
      background: -webkit-linear-gradient(#fff, #e0e0e0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    #cps {
      font-size: 1.1rem;
      opacity: 0.8;
      background: rgba(0,0,0,0.2);
      padding: 5px 15px;
      border-radius: 20px;
      margin-top: 5px;
    }

    /* --- Game Area --- */
    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 20px;
    }

    .click-zone {
      position: relative;
      cursor: pointer;
      transition: transform 0.1s;
    }

    .click-zone:active #klein {
      transform: scale(0.92) rotate(-2deg);
    }

    #klein {
      width: 280px;
      height: 280px;
      object-fit: contain;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
      animation: float 6s ease-in-out infinite;
      transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* Floating Numbers */
    .particle {
      position: absolute;
      font-family: 'Fredoka', sans-serif;
      font-weight: bold;
      color: #fff;
      pointer-events: none;
      animation: flyUp 0.8s ease-out forwards;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      z-index: 50;
    }

    /* --- Shop Section --- */
    .shop-container {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    .shop-title {
      font-family: 'Fredoka', sans-serif;
      margin-bottom: 15px;
      font-size: 1.5rem;
      border-bottom: 2px solid rgba(255,255,255,0.1);
      padding-bottom: 10px;
    }

    .shop-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 15px;
      padding-bottom: 40px;
    }

    .shop-item {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 15px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .shop-item:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .item-name { font-weight: 700; font-size: 1.1rem; }
    .item-count { 
      background: rgba(0,0,0,0.3); 
      padding: 2px 8px; 
      border-radius: 8px; 
      font-size: 0.9rem;
    }

    .item-cps { color: #aaa; font-size: 0.85rem; margin-bottom: 10px; }

    .buy-btn {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 10px;
      background: var(--primary);
      color: white;
      font-family: 'Fredoka', sans-serif;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 0 #d63031;
    }

    .buy-btn:active {
      transform: translateY(4px);
      box-shadow: none;
    }

    .buy-btn:disabled {
      background: #555;
      box-shadow: none;
      color: #888;
      cursor: not-allowed;
      transform: translateY(2px);
    }

    /* --- Utils --- */
    .reset-btn {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0,0,0,0.3);
      color: #aaa;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    /* Mobile Tweaks */
    @media (max-width: 600px) {
      #klein { width: 220px; height: 220px; }
      #score { font-size: 2.8rem; }
      h1 { font-size: 1.8rem; }
    }
  </style>
</head>
<body>

  <header>
    <h1>KleinClicker Pro</h1>
    <div class="scoreboard">
      <div id="score">0</div>
      <div id="cps">0 / Sekunde</div>
    </div>
  </header>

  <main>
    <div class="click-zone" id="clickArea">
      <!-- Bild zentriert und optisch aufgewertet -->
      <img src="https://raw.githubusercontent.com/Janklein25/clicker/main/Kleinclicker.png" alt="Das Gesicht" id="klein">
    </div>
  </main>

  <div class="shop-container">
    <div class="shop-title">Upgrades</div>
    <div class="shop-grid" id="shopGrid">
      <!-- Items werden hier per JS generiert -->
    </div>
  </div>

  <button class="reset-btn" onclick="resetGame()">Spielstand l√∂schen</button>

  <script>
    /* --- Game Configuration --- */
    const GAME_CONFIG = {
      fps: 30, // UI Updates per second (logic runs on requestAnimationFrame)
      saveKey: 'kleinClickerSave_v2'
    };

    /* --- Game State --- */
    let state = {
      score: 0,
      totalClicks: 0,
      startTime: Date.now(),
      upgrades: [
        { id: 'cursor',  name: 'Maus-Fan',    baseCost: 15,    cps: 1,    count: 0, icon: 'üëÜ' },
        { id: 'grandma', name: 'Nette Oma',   baseCost: 100,   cps: 8,    count: 0, icon: 'üëµ' },
        { id: 'farm',    name: 'Kleini-Farm', baseCost: 1100,  cps: 47,   count: 0, icon: 'üöú' },
        { id: 'mine',    name: 'Meme-Mine',   baseCost: 12000, cps: 260,  count: 0, icon: '‚õèÔ∏è' },
        { id: 'factory', name: 'Fabrik',      baseCost: 130000,cps: 1400, count: 0, icon: 'üè≠' }
      ]
    };

    /* --- DOM Elements --- */
    const els = {
      score: document.getElementById('score'),
      cps: document.getElementById('cps'),
      shopGrid: document.getElementById('shopGrid'),
      klein: document.getElementById('klein'),
      clickArea: document.getElementById('clickArea')
    };

    /* --- Initialization --- */
    function init() {
      loadGame();
      renderShop();
      requestAnimationFrame(gameLoop);
      
      // Auto-Save alle 10 Sekunden
      setInterval(saveGame, 10000);
    }

    /* --- Core Logic --- */
    let lastTime = performance.now();
    let accumulatedScore = 0;

    function gameLoop(currentTime) {
      const deltaTime = (currentTime - lastTime) / 1000; // Zeit in Sekunden seit letztem Frame
      lastTime = currentTime;

      const cps = calculateCPS();
      
      if (cps > 0) {
        state.score += cps * deltaTime;
        accumulatedScore += cps * deltaTime;
      }

      updateUI();
      requestAnimationFrame(gameLoop);
    }

    function calculateCPS() {
      return state.upgrades.reduce((total, u) => total + (u.count * u.cps), 0);
    }

    function getCost(upgrade) {
      // Kostenformel: Basis * 1.15^Anzahl
      return Math.round(upgrade.baseCost * Math.pow(1.15, upgrade.count));
    }

    /* --- Interaction --- */
    els.clickArea.addEventListener('mousedown', (e) => {
      handleUserClick(e);
    });
    
    // Support f√ºr Touch ohne Delay
    els.clickArea.addEventListener('touchstart', (e) => {
      e.preventDefault(); // Verhindert Zoom/Scroll beim schnellen Tippen
      // Touch-Koordinaten nutzen
      const touch = e.touches[0];
      handleUserClick({ clientX: touch.clientX, clientY: touch.clientY });
    }, { passive: false });

    function handleUserClick(e) {
      state.score++;
      state.totalClicks++;
      
      // Visueller Effekt (Partikel)
      spawnParticle(e.clientX, e.clientY, "+1");
      
      // Kleiner Bounce-Effekt resetten
      els.klein.style.transform = 'scale(0.95)';
      setTimeout(() => els.klein.style.transform = '', 50);
    }

    function buyUpgrade(index) {
      const upgrade = state.upgrades[index];
      const cost = getCost(upgrade);

      if (state.score >= cost) {
        state.score -= cost;
        upgrade.count++;
        updateShopItem(index);
        saveGame();
        
        // Button Feedback Effekt
        const btn = document.getElementById(`btn-${index}`);
        if(btn) {
            btn.textContent = "Gekauft!";
            setTimeout(() => btn.textContent = "Kaufen", 500);
        }
      }
    }

    /* --- Visuals --- */
    function spawnParticle(x, y, text) {
      const p = document.createElement('div');
      p.className = 'particle';
      p.textContent = text;
      
      // Zuf√§llige Variation
      const randomX = (Math.random() - 0.5) * 40;
      
      p.style.left = `${x + randomX}px`;
      p.style.top = `${y - 20}px`;
      p.style.fontSize = `${Math.random() * 0.5 + 1.5}rem`;
      p.style.color = `hsl(${Math.random() * 60 + 30}, 100%, 70%)`; // Gold/Gelb/Orange T√∂ne

      document.body.appendChild(p);
      setTimeout(() => p.remove(), 800);
    }

    function updateUI() {
      // Score formatieren (Tausendertrennzeichen)
      els.score.textContent = Math.floor(state.score).toLocaleString('de-DE');
      els.cps.textContent = calculateCPS().toLocaleString('de-DE', {maximumFractionDigits: 1}) + " / Sek";
      
      // Dokument Titel aktualisieren (Optional)
      document.title = `${Math.floor(state.score).toLocaleString('de-DE')} - KleinClicker`;

      // Buttons aktivieren/deaktivieren basierend auf Score
      state.upgrades.forEach((u, index) => {
        const btn = document.getElementById(`btn-${index}`);
        if (btn) {
          const cost = getCost(u);
          btn.disabled = state.score < cost;
          // Preis im Button aktualisieren falls n√∂tig, oder separat
          document.getElementById(`cost-${index}`).textContent = cost.toLocaleString('de-DE');
        }
      });
    }

    function renderShop() {
      els.shopGrid.innerHTML = '';
      state.upgrades.forEach((u, index) => {
        const cost = getCost(u);
        const item = document.createElement('div');
        item.className = 'shop-item';
        item.innerHTML = `
          <div class="item-header">
            <span class="item-name">${u.icon} ${u.name}</span>
            <span class="item-count" id="count-${index}">${u.count}</span>
          </div>
          <div class="item-cps">+${u.cps} CPS</div>
          <button class="buy-btn" id="btn-${index}" onclick="buyUpgrade(${index})">
             <span id="cost-${index}">${cost.toLocaleString('de-DE')}</span> Kleinis
          </button>
        `;
        els.shopGrid.appendChild(item);
      });
    }

    function updateShopItem(index) {
      // Nur Anzahl aktualisieren, der Rest passiert in updateUI
      document.getElementById(`count-${index}`).textContent = state.upgrades[index].count;
    }

    /* --- Save/Load System --- */
    function saveGame() {
      const dataToSave = {
        score: state.score,
        upgrades: state.upgrades.map(u => ({ id: u.id, count: u.count })),
        savedAt: Date.now()
      };
      localStorage.setItem(GAME_CONFIG.saveKey, JSON.stringify(dataToSave));
    }

    function loadGame() {
      const saved = localStorage.getItem(GAME_CONFIG.saveKey);
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          state.score = parsed.score || 0;
          
          // Upgrades abgleichen (falls wir sp√§ter neue hinzuf√ºgen, geht der Spielstand nicht kaputt)
          if (parsed.upgrades) {
            parsed.upgrades.forEach(savedUpgrade => {
              const match = state.upgrades.find(u => u.id === savedUpgrade.id);
              if (match) {
                match.count = savedUpgrade.count;
              }
            });
          }
        } catch (e) {
          console.error("Savegame korrupt, starte neu.");
        }
      }
    }

    function resetGame() {
      if(confirm("Wirklich alles l√∂schen?")) {
        localStorage.removeItem(GAME_CONFIG.saveKey);
        location.reload();
      }
    }

    // Start!
    init();

  </script>
</body>
</html>
